---
title: "Data Analysis Intro Exercise"
---

## Loading and checking data

```{r}
if (!requireNamespace("dslabs", quietly = TRUE)) {
  install.packages("dslabs")
}

library("dslabs")
library("tidyverse")
```


```{r}
# only run the next command interactively, not in a script
# help(gapminder)  
# get an overview of data structure
str(gapminder)

# get a summary of data
summary(gapminder)

# determine the type of object gapminder is
class(gapminder)
```

## Processing data

In this section, we use functions from the tidyverse to process the data.
```{r}
africadata <- gapminder %>%
  filter(continent == "Africa")

# Inspect the structure of the African dataset
str(africadata)

# Summarize the dataset to confirm the number of observations
summary(africadata)
```


```{r}
# select() keeps only the specified columns infant mortality and life expectancy

africa_infant_life <- africadata %>%
  select(infant_mortality, life_expectancy)

# Examine the structure of the new dataset
str(africa_infant_life)

# Display summary statistics for the selected variables
summary(africa_infant_life)

# select() keeps only the specified columns population and life expectancy
africa_pop_life <- africadata %>%
  select(population, life_expectancy)

# Check the structure and summary of the dataset
str(africa_pop_life)

# Show summary statistics
summary(africa_pop_life)
```


## Plotting

The following plots visualize life expectancy as a function of
infant mortality and population size.
```{r}
# Plot life expectancy vs infant mortality
ggplot(data = africa_infant_life,
       mapping = aes(x = infant_mortality, y = life_expectancy)) +
  geom_point() +
  labs(
    title = "Life expectancy vs. infant mortality (Africa, all years)",
    x = "Infant mortality",
    y = "Life expectancy"
  )


# Plot life expectancy vs population (log scale)
ggplot(data = africa_pop_life,
       mapping = aes(x = population, y = life_expectancy)) +
  geom_point() +
  scale_x_log10() +
  labs(
    title = "Life expectancy vs. population (Africa, all years)",
    x = "Population (log10 scale)",
    y = "Life expectancy"
  )
```

### Interpreting the streaks pattern

In both plots, the points form streaks that look like separate trajectories. This happens because the dataset
contains repeated measurements for the same country across multiple years.
Within each country, population tends to increase over time, and life expectancy also often increases over time. 

## More data processing and More plotting

Next, we identify which years have missing values for infant mortality.
We avoid years with missing infant mortality data and select a year with
good coverage for cross-sectional analysis. Examine the cross-sectional relationship in a single year (2000)


```{r}
# Identify years with missing infant mortality
missing_years <- africadata %>%
  filter(is.na(infant_mortality)) %>%
  distinct(year) %>%
  arrange(year)

missing_years


# Subset africadata to year 2000
africa2000 <- africadata %>%
  filter(year == 2000)

# Expected: 51 observations and 9 variables
str(africa2000)

# Summarize the dataset
summary(africa2000)

# Plot (year 2000) life expectancy vs infant mortality
ggplot(data = africa2000,
       mapping = aes(x = infant_mortality, y = life_expectancy)) +
  geom_point() +
  labs(
    title = "Life expectancy vs. infant mortality (Africa, year 2000)",
    x = "Infant mortality",
    y = "Life expectancy"
  )

  # Plot (year 2000) life expectancy vs population (log scale)
ggplot(data = africa2000,
       mapping = aes(x = population, y = life_expectancy)) +
  geom_point() +
  scale_x_log10() +
  labs(
    title = "Life expectancy vs. population (Africa, year 2000)",
    x = "Population (log10 scale)",
    y = "Life expectancy"
  )
```

In the year of 2000 plots, the streak pattern disappears because we are nolonger mixing multiple years per country. The negative association between
infant mortality and life expectancy still appears. 
However, the relationship between population size and life expectancy is not visually strong in this year cross-section, suggesting that the positive association seen earlier was largely driven by time trends within countries

## Simple model fits


```{r}
# fit1: fit life expectancy as the outcome, and infant mortality as the predictor
fit1 <- lm(life_expectancy ~ infant_mortality, data = africa2000)

# Print the regression summary (coefficients, p-values, R-squared, etc.)
summary(fit1)
```

```{r}
# fit2: fit life expectancy as the outcome, and population size as the predictor
fit2 <- lm(life_expectancy ~ population, data = africa2000)

# Print the regression summary (coefficients, p-values, R-squared, etc.)
summary(fit2)
```

### Model results

Using data from the year 2000, the linear regression of life expectancy on
infant mortality shows a strong negative association. The estimated slope is
âˆ’0.19 (p < 0.001), indicating that higher infant mortality is associated with
lower life expectancy. This model explains a substantial portion of the
variation in life expectancy across African countries (R^2 = 0.47). 

In contrast, the regression of life expectancy on population size shows no
evidence of an association. The population coefficient is close to zero and
not statistically significant (p = 0.616), and the model explains almost none
of the variation in life expectancy (R^2 = 0.005). These results are consistent
with the patterns observed in the scatter plots.

## This section contributed by Esther Palmer

I have chosen the dataset divorce_margarine, which looks at divorce rates and margerine consumption on a per capita basis. I am very intrigued to see if there's any kind of relationship between these two things, as I would hypothesise that there should not be.

```{r}
library("dslabs")
# loads libraries for this project
# dslabs has data

str(divorce_margarine)
summary(divorce_margarine)
#gives an overview of the data

is.na(divorce_margarine)
#checks for missing data
#there is no missing data

plot(divorce_margarine$year, divorce_margarine$margarine_consumption_per_capita)
#plots the consumption of margarine in the us per capita over the years

plot(divorce_margarine$year, divorce_margarine$divorce_rate_maine)
#plots the divorce rate in main over the years
```

After looking at these two plots separately, I see that they look very similar. Now I want to see if I can get them both into one plot.
```{r}
#these variables are long so I'm going to make them shorter
y <- divorce_margarine$year
d <- divorce_margarine$divorce_rate_maine
m <- divorce_margarine$margarine_consumption_per_capita

plot(y, m, col = "green", pch=19)
points(y, d, col = "blue", pch=19)
#plots both series on the same graph
#margarine consumption is in green
#divorce rate is in blue
```

When looking at the two separate plots I was worried that I would have to conclude that we should all eat less margarine for the sake of our marriages. While I am well aware correlation does not equal causation, after looking at the two separate plots graphed against each other I am no longer convinced that there is much of a correlation. The divorce rate per capita has actually remained fairly steady while the margarine consumption per capita has fallen.
I also think it should be noted that as far as I can tell, it's the divorce rate in maine, and margarine consumption for the US as a whole, which is not a fair comparison.

```{r}
fit <- lm(d ~ m)
summary(fit)
#this is a linear model of the divorce rate and margarine consumption
```
If I am interpreting this correctly, it looks like margarine consumption has a small (.2) positive correlation with divorce rate and it is statistically signifigant.